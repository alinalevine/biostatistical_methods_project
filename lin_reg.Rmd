---
title: "lin_reg"
author: "Alina Levine"
date: "December 9, 2018"
output: html_document
---


```{r}
library(tidyverse)
library(ggplot2)
library(HH)
library("leaps")
```



#data cleaning

I want to fit one model where I include cancer incidence rate and one where I don't 

pct other race does not make sense bc race percentages should add up to 100 but they do not. pct_some_col18_24 lin combo of 3 other variables

```{r}

death_data_full = read_csv("data/Cancer_Registry.csv") %>%
  janitor::clean_names()

death_data = read_csv("data/Cancer_Registry.csv") %>%
  janitor::clean_names() %>%
  dplyr::select(-c(avg_ann_count,avg_deaths_per_year, pct_some_col18_24, pct_other_race, binned_inc, geography))



```


median income and poverty_percent are highly correlated, so I will just use median income
percent private coverage and pct_public_coverage_alone are highly negatively correlated: because when more people have just public covergage, fewer people have private coverage

#Multicollinearity

```{r}
cor(death_data)
death_data = death_data %>%
  dplyr::select(-c(med_income, pct_private_coverage))

fit_full_1 = lm(target_death_rate ~., data = death_data)

vif(fit_full_1)
#median_age_male, #median_age_female have high vif, I will take those out and just use median age
#percent_white and #percent_black have high vif, I will take out pct_black
#pct_married_households has high vif
#pct_employed16_over has high vif, pct_private_coverage_alone

death_data = death_data_full %>%
  dplyr::select(-c(pct_black, pct_asian, pct_employed16_over, median_age_male, median_age_female, pct_married_households, avg_ann_count,avg_deaths_per_year, pct_some_col18_24, pct_other_race, binned_inc, geography, med_income, pct_hs25_over, pct_private_coverage_alone))

fit_full_2 = lm(target_death_rate ~., data = death_data)

vif(fit_full_2)


#there is still high-multicollinearity among insurance variables, so I will remove 
#pct_public_coverage_alone


death_data = death_data_full %>%
  dplyr::select(-c(pct_black, pct_asian, pct_employed16_over, median_age_male, median_age_female, pct_married_households, avg_ann_count,avg_deaths_per_year, pct_some_col18_24, pct_other_race, binned_inc, geography, med_income, pct_hs25_over, pct_private_coverage_alone, pct_public_coverage_alone))

fit_full_3 = lm(target_death_rate ~., data = death_data)

vif(fit_full_3)

#will remove pct_private_coverage

death_data = death_data_full %>%
  dplyr::select(-c(pct_black, pct_asian, pct_employed16_over, median_age_male, median_age_female, pct_married_households, avg_ann_count,avg_deaths_per_year, pct_some_col18_24, pct_other_race, binned_inc, geography, med_income, pct_hs25_over, pct_private_coverage_alone, pct_public_coverage_alone, pct_private_coverage))



fit_full_4 = lm(target_death_rate ~., data = death_data)

vif(fit_full_4)

```


#Stepwise

```{r}
model = fit_full_4

step(model, direction='backward')


summary(model)


```
variables selected are : incidence rate, pop_est2015, poverty_percent, pct_no_hs18_24, pct_hs18_24, pct_bach_deg25_over, pct_unemployed16_over, pct_emp_priv_coverage, pct_public_coverage, pct_white, birth_rate


#Criteria

```{r}

best <- function(model, ...) 
{
  subsets <- regsubsets(formula(model), model.frame(model), ...)
  subsets <- with(summary(subsets),
                  cbind(p = as.numeric(rownames(which)), which, rss, rsq, adjr2, cp, bic))
  
  return(subsets)
}  

View(best(model))
```

the cp is minimized and adjusted r squared is maximimized in the following model:

incidence rate, poverty_percent, pct_nohs_18_24, pct_hs_18_24, pct_bachdeg_25_over, pct_unemployed16_over, pct_emp_priv_coverage_ birth_rate 

```{r}
plot(model)


```

